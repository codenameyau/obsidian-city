/**
 * @author qiao / https://github.com/qiao
 * @author mrdoob / http://mrdoob.com
 * @author alteredq / http://alteredqualia.com/
 * @author WestLangley / http://github.com/WestLangley
 */
'use strict';

THREE.OrbitControls=function(a,b){function s(){return 2*Math.PI/60/60*c.autoRotateSpeed}function t(){return Math.pow(.95,c.userZoomSpeed)}function u(a){c.enabled!==!1&&c.userRotate!==!1&&(a.preventDefault(),q===p.NONE&&(0===a.button&&(q=p.ROTATE),1===a.button&&(q=p.ZOOM),2===a.button&&(q=p.PAN)),q===p.ROTATE?f.set(a.clientX,a.clientY):q===p.ZOOM?i.set(a.clientX,a.clientY):q===p.PAN,document.addEventListener("mousemove",v,!1),document.addEventListener("mouseup",w,!1))}function v(a){if(c.enabled!==!1)if(a.preventDefault(),q===p.ROTATE)g.set(a.clientX,a.clientY),h.subVectors(g,f),c.rotateLeft(2*Math.PI*h.x/e*c.userRotateSpeed),c.rotateUp(2*Math.PI*h.y/e*c.userRotateSpeed),f.copy(g);else if(q===p.ZOOM)j.set(a.clientX,a.clientY),k.subVectors(j,i),k.y>0?c.zoomIn():c.zoomOut(),i.copy(j);else if(q===p.PAN){var b=a.movementX||a.mozMovementX||a.webkitMovementX||0,d=a.movementY||a.mozMovementY||a.webkitMovementY||0;c.pan(new THREE.Vector3(-b,d,0))}}function w(){c.enabled!==!1&&c.userRotate!==!1&&(document.removeEventListener("mousemove",v,!1),document.removeEventListener("mouseup",w,!1),q=p.NONE)}function x(a){if(c.enabled!==!1&&c.userZoom!==!1){var b=0;a.wheelDelta?b=a.wheelDelta:a.detail&&(b=-a.detail),b>0?c.zoomOut():c.zoomIn()}}function y(a){if(c.enabled!==!1&&c.userPan!==!1)switch(a.keyCode){case c.keys.ROTATE:q=p.ROTATE;break;case c.keys.ZOOM:q=p.ZOOM;break;case c.keys.PAN:q=p.PAN}}function z(a){switch(a.keyCode){case c.keys.ROTATE:case c.keys.ZOOM:case c.keys.PAN:q=p.NONE}}this.object=a,this.domElement=void 0!==b?b:document,this.enabled=!0,this.center=new THREE.Vector3,this.userZoom=!0,this.userZoomSpeed=1,this.userRotate=!0,this.userRotateSpeed=1,this.userPan=!0,this.userPanSpeed=2,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minDistance=0,this.maxDistance=1/0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40,ROTATE:65,ZOOM:83,PAN:68};var c=this,d=1e-6,e=1800,f=new THREE.Vector2,g=new THREE.Vector2,h=new THREE.Vector2,i=new THREE.Vector2,j=new THREE.Vector2,k=new THREE.Vector2,l=0,m=0,n=1,o=new THREE.Vector3,p={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},q=p.NONE,r={type:"change"};this.rotateLeft=function(a){void 0===a&&(a=s()),m-=a},this.rotateRight=function(a){void 0===a&&(a=s()),m+=a},this.rotateUp=function(a){void 0===a&&(a=s()),l-=a},this.rotateDown=function(a){void 0===a&&(a=s()),l+=a},this.zoomIn=function(a){void 0===a&&(a=t()),n/=a},this.zoomOut=function(a){void 0===a&&(a=t()),n*=a},this.pan=function(a){a.transformDirection(this.object.matrix),a.multiplyScalar(c.userPanSpeed),this.object.position.add(a),this.center.add(a)},this.update=function(){var a=this.object.position,b=a.clone().sub(this.center),c=Math.atan2(b.x,b.z),e=Math.atan2(Math.sqrt(b.x*b.x+b.z*b.z),b.y);this.autoRotate&&this.rotateLeft(s()),c+=m,e+=l,e=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,e)),e=Math.max(d,Math.min(Math.PI-d,e));var f=b.length()*n;f=Math.max(this.minDistance,Math.min(this.maxDistance,f)),b.x=f*Math.sin(e)*Math.sin(c),b.y=f*Math.cos(e),b.z=f*Math.sin(e)*Math.cos(c),a.copy(this.center).add(b),this.object.lookAt(this.center),m=0,l=0,n=1,o.distanceTo(this.object.position)>0&&(this.dispatchEvent(r),o.copy(this.object.position))},this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1),this.domElement.addEventListener("mousedown",u,!1),this.domElement.addEventListener("mousewheel",x,!1),this.domElement.addEventListener("DOMMouseScroll",x,!1),window.addEventListener("keydown",y,!1),window.addEventListener("keyup",z,!1)},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);
